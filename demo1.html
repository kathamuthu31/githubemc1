<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CRUD Example — Todo List (HTML/CSS/JS)</title>
  <style>
    :root{--bg:#f7f8fb;--card:#fff;--muted:#6b7280;--accent:#2563eb}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:0; padding:32px; color:#0f172a}
    .wrap{max-width:760px;margin:0 auto}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(12,20,40,0.06)}
    form{display:flex;gap:8px}
    input[type="text"]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
    button{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:0;font-weight:600;cursor:pointer}
    button.secondary{background:#eaeefb;color:var(--accent);font-weight:600}

    ul.list{list-style:none;padding:0;margin:18px 0 0}
    li.item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;border:1px solid #eef2ff;background:#fff;margin-bottom:10px}
    .content{flex:1;display:flex;flex-direction:column}
    .title{font-size:15px;margin:0}
    .meta{font-size:12px;color:var(--muted)}
    .controls{display:flex;gap:8px}
    .btn-icon{background:transparent;border:1px solid #e6e9ef;padding:8px;border-radius:8px;cursor:pointer}
    .btn-icon:hover{transform:translateY(-1px)}
    .edit-input{padding:6px 8px;border-radius:6px;border:1px solid #e6e9ef}

    .empty{padding:28px;text-align:center;color:var(--muted)}

    @media (max-width:520px){body{padding:16px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Simple CRUD — Todo list</h1>
      <p class="lead">Create, Read, Update & Delete items. Data stored in localStorage (no server required).</p>
    </header>

    <section class="card" aria-labelledby="main-title">
      <form id="addForm" aria-label="Add new todo">
        <input id="newText" type="text" placeholder="Add a new item..." required />
        <button type="submit">Create</button>
      </form>

      <ul id="list" class="list" aria-live="polite"></ul>

      <div id="empty" class="empty" hidden>No items yet. Add one above.</div>
    </section>

    <p style="margin-top:12px;font-size:13px;color:var(--muted)">Tip: Edit inline using the Edit button. Changes persist in your browser.</p>
  </div>

  <script>
    (function(){
      // Simple CRUD with localStorage
      const STORAGE_KEY = 'crud_todo_items_v1';

      const $list = document.getElementById('list');
      const $form = document.getElementById('addForm');
      const $newText = document.getElementById('newText');
      const $empty = document.getElementById('empty');

      // --- Utilities ---
      function uid(){ return Math.random().toString(36).slice(2,9); }

      function load(){
        try{
          return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        }catch(e){
          console.error('Failed to parse storage', e);
          return [];
        }
      }

      function save(items){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      }

      // --- CRUD operations ---
      function create(text){
        const items = load();
        const item = { id: uid(), text: text.trim(), done: false, createdAt: Date.now() };
        items.unshift(item); // newest first
        save(items);
        return item;
      }

      function read(){
        return load();
      }

      function update(id, patch){
        const items = load();
        const idx = items.findIndex(i=>i.id===id);
        if(idx===-1) return null;
        items[idx] = {...items[idx], ...patch};
        save(items);
        return items[idx];
      }

      function remove(id){
        let items = load();
        items = items.filter(i=>i.id!==id);
        save(items);
      }

      // --- Rendering ---
      function formatDate(ts){
        const d = new Date(ts);
        return d.toLocaleString();
      }

      function render(){
        const items = read();
        $list.innerHTML = '';
        if(items.length===0){ $empty.hidden = false; return }
        $empty.hidden = true;

        items.forEach(item => {
          const li = document.createElement('li');
          li.className = 'item';
          li.dataset.id = item.id;

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = !!item.done;

          checkbox.addEventListener('change', ()=>{
            update(item.id, { done: checkbox.checked });
            render();
          });

          const content = document.createElement('div');
          content.className = 'content';

          const title = document.createElement('p');
          title.className = 'title';
          title.textContent = item.text;
          if(item.done) title.style.textDecoration = 'line-through';

          const meta = document.createElement('div');
          meta.className = 'meta';
          meta.textContent = 'Created: ' + formatDate(item.createdAt);

          content.appendChild(title);
          content.appendChild(meta);

          const controls = document.createElement('div');
          controls.className = 'controls';

          // Edit button
          const btnEdit = document.createElement('button');
          btnEdit.className = 'btn-icon';
          btnEdit.setAttribute('aria-label','Edit item');
          btnEdit.textContent = 'Edit';
          btnEdit.addEventListener('click', ()=> startEdit(item, title));

          // Delete button
          const btnDel = document.createElement('button');
          btnDel.className = 'btn-icon';
          btnDel.setAttribute('aria-label','Delete item');
          btnDel.textContent = 'Delete';
          btnDel.addEventListener('click', ()=>{
            if(confirm('Delete this item?')){
              remove(item.id);
              render();
            }
          });

          controls.appendChild(btnEdit);
          controls.appendChild(btnDel);

          li.appendChild(checkbox);
          li.appendChild(content);
          li.appendChild(controls);

          $list.appendChild(li);
        });
      }

      // Inline edit flow
      function startEdit(item, titleEl){
        const parent = titleEl.parentElement;
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'edit-input';
        input.value = item.text;
        input.setAttribute('aria-label','Edit item text');

        const saveBtn = document.createElement('button');
        saveBtn.className = 'btn-icon';
        saveBtn.textContent = 'Save';

        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'btn-icon';
        cancelBtn.textContent = 'Cancel';

        // Temporarily replace content
        parent.replaceChild(input, titleEl);
        parent.appendChild(saveBtn);
        parent.appendChild(cancelBtn);
        input.focus();

        saveBtn.addEventListener('click', ()=>{
          const newText = input.value.trim();
          if(newText){ update(item.id, { text: newText }); }
          render();
        });

        cancelBtn.addEventListener('click', ()=> render());

        input.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter') saveBtn.click();
          if(e.key === 'Escape') cancelBtn.click();
        });
      }

      // --- Form handling ---
      $form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const val = $newText.value.trim();
        if(!val) return;
        create(val);
        $newText.value = '';
        render();
      });

      // Init demo data if empty (optional)
      (function seed(){
        const items = read();
        if(items.length===0){
          create('Welcome — this is a CRUD demo. Edit me!');
          create('Try create, update, delete and toggle completion.');
        }
      })();

      // Initial render
      render();

      // Expose functions for debugging (optional)
      window.crud = { read, create, update, remove };
    })();
  </script>
</body>
</html>
